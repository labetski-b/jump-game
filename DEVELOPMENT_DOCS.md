# Техническая документация: "Прыжки между колоннами"

## Обзор проекта

**Концепция**: Аддиктивная 2D игра-симуляция финансовых решений, где игрок прыгает между стабильной и волатильной колоннами, стремясь максимизировать высоту стабильной колонны.

**Цель**: Создать максимально захватывающий игровой опыт, моделирующий психологию трейдинга и инвестиций.

## Визуальный дизайн

### Цветовая схема
```css
/* Основные цвета */
--stable-column: linear-gradient(180deg, #2D5016 0%, #4CAF50 100%)
--volatile-column-up: linear-gradient(180deg, #FFC107 0%, #FF9800 50%, #FF1744 100%)
--volatile-column-down: linear-gradient(180deg, #FF1744 0%, #FF9800 50%, #FFC107 100%)
--background: #1A1A1A
--player: #FFFFFF
--ui-profit: #00FF41
--ui-loss: #FF4444
--text: #E0E0E0
```

### Компоненты интерфейса
- **Колонны**: Прямоугольники с градиентными заливками
- **Персонаж**: Белый круг диаметром 20px с тенью
- **Процент изменения**: Плавающий текст над стабильной колонной
- **Траектория прыжка**: Пунктирная дуга между колоннами

## Техническая архитектура

### Технологический стек
- **Frontend**: HTML5 Canvas + JavaScript (ES6+)
- **Анимации**: RequestAnimationFrame + CSS Transitions
- **Физика**: Собственный движок на базе функций Perlin Noise
- **Стейт менеджмент**: Простой объектно-ориентированный подход

### Структура файлов
```
/src
  /js
    game.js           # Основной игровой движок
    columns.js        # Логика колонн
    player.js         # Персонаж и анимации прыжков
    volatility.js     # Алгоритм волатильности
    ui.js             # Пользовательский интерфейс
  /css
    styles.css        # Стили
  /assets
    sounds/           # Звуковые эффекты (опционально)
  index.html          # Точка входа
```

## Игровая механика

### Основные состояния игры
```javascript
const GameStates = {
  WAITING: 'waiting',     // Игрок на колонне, ожидает клика
  JUMPING: 'jumping',     // Анимация прыжка (2 сек)
  CALCULATING: 'calculating' // Пересчет высот
}
```

### Логика колонн

#### Стабильная колонна
- **Начальная высота**: 100 единиц
- **Изменение**: Только при прыжке с волатильной
- **Формула**: `новая_высота = высота_волатильной_на_момент_прыжка * 0.998` (комиссия 0.2%)

#### Волатильная колонна
- **Начальная высота**: 99.8 единиц (100 - 0.2%)
- **Поведение**: Постоянные плавные колебания
- **Диапазон**: от 1 до 10000 единиц (в прототипе)
- **Алгоритм**: Комбинация Perlin Noise + случайные импульсы

### Алгоритм волатильности

```javascript
class VolatilityEngine {
  constructor() {
    this.time = 0;
    this.baseValue = 99.8;
    this.noiseScale = 0.01;
    this.impulseFactor = 1.0;
    this.trendDirection = 1;
  }
  
  update(deltaTime) {
    this.time += deltaTime;
    
    // Базовые колебания (Perlin Noise)
    const noiseValue = this.perlinNoise(this.time * this.noiseScale);
    
    // Случайные импульсы (имитация новостей/событий)
    const impulse = this.generateImpulse();
    
    // Микротренды
    const microTrend = this.calculateMicroTrend();
    
    // Комбинируем все факторы
    const change = (noiseValue * 0.5 + impulse * 0.3 + microTrend * 0.2) * this.impulseFactor;
    
    this.baseValue = Math.max(1, Math.min(10000, this.baseValue * (1 + change)));
    
    return this.baseValue;
  }
}
```

### Анимация прыжка

```javascript
class JumpAnimation {
  constructor(fromColumn, toColumn, duration = 2000) {
    this.startTime = Date.now();
    this.duration = duration;
    this.startPos = fromColumn.getPlayerPosition();
    this.endPos = toColumn.getPlayerPosition();
  }
  
  getPlayerPosition(currentTime) {
    const progress = (currentTime - this.startTime) / this.duration;
    if (progress >= 1) return this.endPos;
    
    // Параболическая траектория
    const x = this.lerp(this.startPos.x, this.endPos.x, progress);
    const y = this.parabolicY(progress);
    
    return { x, y };
  }
  
  parabolicY(t) {
    const height = Math.max(this.startPos.y, this.endPos.y) + 50;
    return this.lerp(this.startPos.y, this.endPos.y, t) - 4 * height * t * (1 - t);
  }
}
```

## Система обратной связи

### Визуальная обратная связь
- **Изменение процентов**: Анимированный текст с цветовой кодировкой
- **Пульсация колонн**: При значительных изменениях
- **Частицы успеха**: При положительном результате прыжка
- **Встряхивание экрана**: При больших потерях

### Звуковая обратная связь (опционально)
- Тик волатильности (subtle)
- Звук прыжка
- Звуки успеха/неудачи
- Фоновая атмосфера

## Математические модели

### Расчет процентного изменения
```javascript
function calculatePercentageChange(oldValue, newValue) {
  return ((newValue - oldValue) / oldValue) * 100;
}
```

### Генерация Perlin Noise (упрощенная версия)
```javascript
class SimplexNoise {
  // Реализация алгоритма Perlin Noise для плавных колебаний
  noise(x) {
    const i = Math.floor(x);
    const f = x - i;
    const u = this.fade(f);
    
    return this.lerp(this.grad(this.p[i & 255], f),
                     this.grad(this.p[(i + 1) & 255], f - 1), u);
  }
}
```

## Психологические механики аддиктивности

### Variable Ratio Reinforcement
- Непредсказуемые награды за удачные прыжки
- Случайные "бонусные" моменты с повышенной волатильностью

### Near Miss Effect
- Показ потенциальной прибыли, если бы игрок подождал еще немного
- Визуальные подсказки о "почти идеальном" тайминге

### Progress Tracking
- Отображение максимального достигнутого значения
- Визуальный прогресс к следующему "уровню" (100, 200, 500, 1000...)

## Производительность

### Оптимизации
- **RAF throttling**: Ограничение FPS до 60
- **Viewport culling**: Отрисовка только видимых элементов
- **Object pooling**: Переиспользование объектов частиц
- **Batch operations**: Группировка DOM манипуляций

### Метрики производительности
- Время отклика на клик: < 16ms
- Плавность анимаций: стабильные 60 FPS
- Размер загрузки: < 100KB

## План разработки (MVP)

### Фаза 1: Базовая механика (1-2 дня)
1. Создание canvas и базовой отрисовки
2. Реализация двух колонн
3. Простая система кликов и прыжков
4. Базовый алгоритм волатильности

### Фаза 2: Анимации и полировка (1-2 дня)
1. Плавные анимации прыжков
2. Визуальная обратная связь
3. Система показа процентов
4. Тестирование аддиктивности

### Фаза 3: Оптимизация (1 день)
1. Производительность
2. Кроссбраузерность
3. Мобильная адаптация
4. Финальная настройка баланса

## Тестирование

### Функциональное тестирование
- [ ] Корректность расчета высот
- [ ] Плавность анимаций
- [ ] Отзывчивость интерфейса
- [ ] Математическая точность

### Пользовательское тестирование
- [ ] Интуитивность управления
- [ ] Аддиктивность геймплея
- [ ] Время удержания внимания
- [ ] Понятность механик

## Расширения (будущие версии)

### Дополнительные механики
- Система достижений
- Мультиплеер (соревнования)
- Различные типы колонн
- Система прогрессии

### Аналитика
- Трекинг пользовательского поведения
- A/B тестирование параметров волатильности
- Метрики вовлеченности

---

**Дата создания**: $(date)  
**Автор**: AI Assistant  
**Версия**: 1.0
